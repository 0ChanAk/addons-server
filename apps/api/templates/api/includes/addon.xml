{% cache addon %}
<addon>
  <name>{{ addon.name }}</name>
  <type id="{{ addon.type.id }}">{{ amo.ADDON_TYPE[addon.type.id] }}</type>
  <guid>{{ addon.guid }}</guid>
  <version>{{ addon.current_version.version }}</version>
  <status id="{{ addon.status }}">{{ amo.STATUS_CHOICES[addon.status] }}</status>
  <authors>
    {% for author in addon.authors.filter(addonuser__listed=True) %}
    {% if api_version >= 1.5 %}
    <author>
      <name>{{ author.display_name }}</name>
      <link>{{ author.get_url_path()|absolutify|urlparams(src='api') }}</link>
    </author>
    {% else %}
    <author>{{ author.display_name }}</author>
    {% endif %}
    {% endfor %}
  </authors>
  <summary>{{ addon.summary }}</summary>
  <description>{{ addon.description }}</description>
  <icon>{{ addon.icon_url }}</icon>
  <compatible_applications>
    {% if addon.current_version %}
    {% for app in addon.current_version.applicationsversions_set.all() %}
    {% if amo.APP_IDS.get(app.application_id) %}
    <application>
      <name>{{ amo.APP_IDS[app.application_id].pretty }}</name>
      <application_id>{{ app.application_id }}</application_id>
      <min_version>{{ app.min }}</min_version>
      <max_version>{{ app.max }}</max_version>
      <appID>{{ amo.APP_IDS[app.application_id].guid }}</appID>
    </application>
    {% endif %}
    {% endfor %}
    {% endif %}
  </compatible_applications>
  <all_compatible_os>
    {% if addon.current_version %}
    {% for os in addon.current_version.supported_platforms %}
    <os>{{ os }}</os>
    {% endfor %}
    {% endif %}
  </all_compatible_os>
  <eula>{{ addon.eula }}</eula>
  <thumbnail>{{ addon.thumbnail_url }}</thumbnail>
  <rating>{{ addon.bayesian_rating|wround(0, 'ceil') }}</rating>
  <learnmore>
    {{ settings.SITE_URL+addon.get_url_path()|absolutify|urlparams(src='api') }}</learnmore>
  {% if addon.current_version %}
  {% for file in addon.current_version.files.all() %}
  <install hash="{{ file.hash }}" os="{{ file.platform.name }}"
    size="{{ file.size }}" units="kb">
    {{ file.get_url_path('api')|absolutify }}
  </install>
  {% endfor %}
  {% endif %}
  {% if api_version >= 1.5 %}
  {% if addon.wants_contributions %}
  <contribution_data>
    <link>{{ addon.contribution_url|absolutify|urlparams(src='api') }}</link>
    <suggested_amount>{{ addon.suggested_amount }}</suggested_amount>
    <meet_developers>{{ addon.meet_developers_url|absolutify|urlparams(src='api')  }}</meet_developers>
  </contribution_data>
  {% endif %}
  <reviews num="{{ addon.total_reviews }}">{{ addon.reviews_url|absolutify|urlparams(src='api')  }}</reviews>
  <total_downloads>{{ addon.total_downloads }}</total_downloads>
  <weekly_downloads>{{ addon.weekly_downloads }}</weekly_downloads>
  <daily_users>{{ addon.average_daily_users }}</daily_users>
  <created>{{ addon.created }}</created>
  <last_updated>{{ addon.last_updated }}</last_updated>
  {% endif %}
</addon>
{% endcache %}
