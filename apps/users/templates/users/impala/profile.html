{% extends "impala/base.html" %}

{% block title %}{{ page_title(_('User Info for {0}')|f(profile.name)) }}{% endblock %}
{% block js %}{% include("amo/recaptcha_js.html") %}{% endblock %}
{% block bodyclass %}meet gutter{% endblock %}

{% block content %}

{% include "messages.html" %}

{{ impala_breadcrumbs([(None, profile.name)]) }}
<div id="profile-actions" class="c">
  {% if own_profile %}
    <a class="button" href="{{ url('users.edit') }}">{{ _('Edit Profile') }}</a>
  {% endif %}
  {% if edit_any_user %}
    {# TODO XXX Once zamboni can delete users, uncomment this line.  bug 595035 #}
    {# <a href="{{ url("admin:users_userprofile_change", profile.id) }}">{{ _('Manage User') }}</a> #}
    <a class="button" href="{{ remora_url("/admin/users/%s" % profile.id) }}">{{ _('Manage User') }}</a>
  {% endif %}
  {% if abuse_form %}
    <a id="report-user-abuse" class="button" href="{{ url('users.abuse', profile.id) }}">
      {{ _('Report user') }}</a>
  {% endif %}
</div>
<h1 class="fn n">{{ profile.name }}</h1>

<div class="island c">
  <aside class="secondary">
    <img class="avatar" src="{{ profile.picture_url }}"
         {% if not profile.picture_type %}alt="{{ _('No Photo') }}"{% endif %}>
    {% if profile.is_developer %}
      <div class="user-role"><p>{{ _('Add-ons Developer') }}</p></div>
    {% endif %}
  </aside>
  <section class="primary">
    <h2>{{ _('About Me') }}</h2>
    <div class="vcard">
      {% with table_class='person-info', is_profile=True %}
        {% include "users/impala/vcard.html" %}
      {% endwith %}
    </div>
    <div class="prose">
      {% if profile.bio %}
        <h3>{{ _('In a little more detail...') }}</h3>
        <p class="intro">{{ profile.bio|nl2br }}</p>
      {% endif %}
    </div>
  </section>
</div>

{% if addons.object_list %}
  <div id="my-addons" class="island primary listing c">
    <h2>{{ _("Add-ons I've created") }}</h2>
    {% cache addons.object_list %}
      <div class="items">
        {{ impala_addon_listing_items(addons.object_list, field=sorting, src='userprofile') }}
      </div>
      {{ addons|impala_paginator }}
    {% endcache %}
  </div>
{% endif %}

<aside class="secondary" id="my-collections">
  <div class="island">
    <h2>{{ _('My Collections') }}</h2>
    {% if own_coll or fav_coll %}
      {{ user_collection_list(heading=_('Followed by Me'), collections=fav_coll,
                              link=url('collections.following'), id='my-favorite') }}
      {{ user_collection_list(heading=_('Created by Me'), collections=own_coll,
                              id='my-created',
                              link=url('collections.user', profile.username)) }}
    {% else %}
      <p>{{ _('No collections yet.') }}</p>
    {% endif %}
  </div>
</aside>

{% cache reviews %}
<div class="island primary c" id="reviews">
  <h2>{{ _('My Reviews') }}</h2>
  {% if reviews %}
    <div class="items">
      {% for review in reviews %}
        {% set addon = review.addon %}
        {% with show_addon = True %}
          {% include "reviews/review.html" %}
        {% endwith %}
      {% endfor %}
      {{ edit_review_form() }}
    </div>
  {% else %}
    <p class="no-reviews">{{ _('No add-on reviews yet.') }}</p>
  {% endif %}
</div>
{% endcache %}

{% endblock %}

{% block popups %}
  {{ report_review_popup() }}
  {% if abuse_form %}
    <div id="report-user-modal" class="modal hidden">
      <a href="#" class="close">{{ _('close') }}</a>
      <h2>{{ _('Report User') }}</h2>
      {{ user_report_abuse(hide=False, profile=profile) }}
    </div>
  {% endif %}
{% endblock %}
