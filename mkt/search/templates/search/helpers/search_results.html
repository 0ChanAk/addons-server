{% from 'addons/macros.html' import price %}

{% macro sort_vital(addon, field) %}
  {% if field not in ('created', 'updated') %}
    <div class="vital downloads">
      {% with num=addon.weekly_downloads %}
        {# L10n: {0} is the number of downloads. #}
        {{ ngettext('{0} weekly download', '{0} weekly downloads',
                    num)|f(num|numberfmt) }}
      {% endwith %}
    </div>
  {% endif %}
  {% if field in ('created', 'updated') %}
    <div class="vital updated">
      {% if field == 'created' %}
        {# L10n: {0} is a date. #}
        {{ _('Added {0}')|f(addon.created|datetime) }}
      {% else %}
        {# L10n: {0} is a date. #}
        {{ _('Updated {0}')|f(addon.last_updated|datetime) }}
      {% endif %}
    </div>
  {% endif %}
{% endmacro %}

{% for product in products %}
  <li class="item result app c">
    <div class="info">
      <h3>
        {% set dl_url = product.get_url_path() %}
        {% if dl_src %}
          {% set dl_url = dl_url|urlparams(src=dl_src) %}
        {% endif %}
        <a href="{{ dl_url }}">
          <img class="icon" src="{{ product.get_icon_url(64) }}">
          {{ product.name }}</a>
      </h3>
      <p class="desc">{{ product.summary|nl2br }}</p>
      <div class="vitals c">
        {{ impala_reviews_link(product) }}
        {{ price(product) }}
        {{ sort_vital(product, 'downloads') }}
        {% if field in ('created', 'updated') %}
          {{ sort_vital(product, field) }}
        {% endif %}
        {% if product.device_types %}
          <ul class="compat-list">
            {% for device in product.device_types %}
              <li class="{{ device.class_name }}">
                {{ device.name }}
              </li>
            {% endfor %}
          </ul>
        {% endif %}
      </div>
    </div>
    <div class="actions">
      {{ market_button(product) }}
    </div>
  </li>
{% else %}
  {{ no_results() }}
{% endfor %}
