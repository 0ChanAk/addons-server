{% extends "impala/base.html" %}

{% block title %}
{% if query.q %}
  {# L10n: {0} is the search term, such as Firebug. #}
  {{ page_title(_('{0} :: Search')|f(query.q)) }}
{% else %}
  {{ page_title(_('Search')) }}
{% endif %}
{% endblock %}

{% block extrahead %}
<meta name="WT.oss" content="{{ query.q }}">
<meta name="WT.oss_r" content="{{ pager.paginator.count }}">
{% endblock %}

{% macro facet(title, links) %}
  <li class="facet">
    <h3>{{ title }}</h3>
    {{ facet_links(links) }}
  </li>
{% endmacro %}

{% macro facet_links(links) %}
  <ul>
    {% for link in links recursive %}
    <li{% if link.selected %} class="selected"{% endif %}>
      <a href="{{ request.get_full_path()|urlparams(page=None, **link.urlparams) }}">
        {{ link.text }}</a>
      {% if link.children %}
        <ul>{{ loop(link.children) }}</ul>
      {% endif %}
    </li>
    {% endfor %}
  </ul>
{% endmacro %}

{% block content %}
<section id="search-facets" class="secondary" role="complementary">
  <h2>{{ _('Filter Results') }}</h2>
  <ul class="facets island">
    {{ facet(_('Category'), categories) }}
    <li class="facet">
      <h3>{{ _('Works with') }}</h3>
      {% if versions %}
        {{ facet_links(versions) }}
      {% endif %}
      {% if platforms %}
        {{ facet_links(platforms) }}
      {% endif %}
    </li>
    {{ facet(_('Tag'), tags) }}
  </ul>
  <p>{{ _('{0} matching results')|f(pager.paginator.count|numberfmt) }}</p>
</section>


<section class="primary" role="main">

  <div class="listing results island hero c">
    <header>
      <h2>{{ _('Search Results') }}</h2>
    </header>
    <header>
      {{ impala_addon_listing_header(
             request.get_full_path()|urlparams(page=None),
             sort_opts, query.sort, extra_sort_opts) }}
    </header>
    {% if pager.object_list %}
      <div class="items">
        {{ impala_addon_listing_items(pager.object_list, field=query.sort,
                                      src='search') }}
      </div>
      {{ pager|impala_paginator }}
    {% else %}
      {% include 'search/no_results.html' %}
    {% endif %}
  </div>

</section>
{% endblock %}
