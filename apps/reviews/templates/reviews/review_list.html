{% extends "base.html" %}

{# L10n: {0} is an add-on name. #}
{% block title %}{{ page_title(_('{0} :: Reviews')|f(addon.name)) }}{% endblock %}

{% block bodyclass %}reviews inverse{% endblock %}

{% block rss_feed %}
<link  rel="alternate" type="application/rss+xml"
       title="RSS" href="{{ url('reviews.list', addon.id) }}format:rss">
{% endblock %}

{% block content %}
<div class="primary" role="main">
  <header>
    {# Give a link back to reviews if we're looking at user reviews or a detail page. #}
    {% with link = None if page == 'list' else url('reviews.list', addon.id) %}
      {{ breadcrumbs([(addon.type_url(), amo.ADDON_TYPES[addon.type]),
                      (addon.get_url_path(), addon.name),
                      (link, _('Reviews'))]) }}
    {% endwith %}
    <hgroup>
      {% if page == "list" %}
        <h2>{{ _('Reviews for {0}')|f(addon.name) }}</h2>
        {% with num = reviews.paginator.count %}
          {# L10n: {0} is a number. #}
          <h3>{{ ngettext('<b>{0}</b> review for this add-on',
                          '<b>{0}</b> reviews for this add-on',
                          num)|f(num|numberfmt)|safe }}</h3>
        {% endwith %}
      {% elif reply %}
        {# L10n: {0} is a developer's name. #}
        <h2>{{ _('Developer reply by {0}')|f(reply.user.display_name) }}</h2>
      {% elif reviews %}
        <h2>{% trans cnt=reviews.object_list|length, addon=addon.name,
                     user=reviews.object_list[0].user.display_name %}
          Review for {{ addon }} by {{ user }}
        {% pluralize %}
          Reviews for {{ addon }} by {{ user }}
        {% endtrans %}</h2>
      {% else %}
        <h2>{{ _('No reviews found.') }}</h2>
      {% endif %}
    </hgroup>
  </header>
  <div id="dev-reply-form" class="review article reply reply-form hidden">
    <h3>Write a Reply</h3>
    <form method="POST" action="">
      <label for="reply-title">{{_('Title:')}}</label>
      <input id="reply-title" type="text" name="title" />
      <label for="reply-body">{{_('Reply:')}}</label>
      <textarea id="reply-body" name="body"></textarea>
      <input type="hidden" name="inreplyto" value="" />
      <input type="submit" value="{{ _('Submit Your Reply') }}">
      or <a href="#">Cancel</a>
    </form>
  </div>
  {% for review in reviews.object_list %}
    {% include "reviews/review.html" %}
    {% if review.id in replies %}
      {% with review=replies[review.id] %}
        {% include "reviews/review.html" %}
      {% endwith %}
    {% endif %}
  {% endfor %}
  {{ reviews|paginator }}
</div>

<div class="secondary">
  <div class="highlight">
    <hgroup>
      <h5 {{ addon.name|locale_html }}>
        <a href="{{ addon.get_url_path() }}">
          <img src="{{ addon.icon_url }}" class="icon">
          <span>{{ addon.name }}</span>
        </a>
      </h5>
      <h6 class="author">{{ _('by') }} {{ users_list(addon.listed_authors) }}</h6>
    </hgroup>
    <div>
      <span>
        {{ addon.average_rating|float|stars }}
        {{ _('Average Rating ({0})')|f(addon.total_reviews) }}
      </span>
    </div>
    {% if grouped_ratings %}
      <div>
        <ul>
        {% for rating, count in grouped_ratings|sort(reverse=True) %}
          <li>{{ rating|stars }} {{ count }} </li>
        {% endfor %}
        </ul>
      </div>
    {% endif %}
    <div>
      <a class="button" href="#TODO">
        {{ _('Write a New Review') }}</a>
    </div>
  </div>
</div>

<div class="hidden">
  <div class="install-note review-reason">
    <strong>{{ _('Please select a reason:') }}</strong>
    <ul>
      {% for flag, text in ReviewFlag.FLAGS %}
        <li><a href="#{{ flag }}">{{ text }}</a></li>
      {% endfor %}
    </ul>
    {# Using a fake form so we get submission on keyboard-enter. #}
    <form class="other-note" method="POST" action="">
      {{ flag_form.note|safe }}
      <input type="submit" value="{{ _('Submit') }}">
    </form>
  </div>
</div>
{% endblock content %}
