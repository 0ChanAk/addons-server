{% extends "files/base.html" %}

{% block bodyclass %}inverse{% endblock %}

{% block content %}
<h3>
    <a href="{{ file_url }}">{{ addon.name }} {{ version }}</a>
    {% if file.platform.id != amo.PLATFORM_ALL.id %}({{ file.platform }}){% endif %}
</h3>
<div id="file-viewer">
    {% if not status %}
        <p class="waiting" id="extracting" data-url="{{ poll_url }}">
            {{ _('Add-on file being processed, please wait.') }}
        </p>
    {% endif %}
    <div id="files">
        <ul>
        {% if files %}
            {% for key, value in files.items() %}
                <li data-parent="{{ value['parent'] }}"
                    data-short="{{ value['short'] }}"
                    style="padding-left: {{ value['depth'] }}em"
                    class="{% if value['depth'] %}hidden{% endif %}">
                    <a class="{{ file_viewer_class(value, selected) }}"
                        href="{{ value['url'] }}"
                        title="{{ value['filename'] }}">{{ value['truncated'] }}</a>
                </li>
            {% endfor %}
        {% endif %}
        </ul>
        {% if files %}
        <p>
            <a href="#" id="files-prev">{{ _('Prev') }}</a> |
            <a href="#" id="files-next">{{ _('Next') }}</a><br />
            <a href="#" id="files-expand-all">{{ _('Expand All') }}</a><br />
            <a href="#" id="files-unwrap">{{ _('Unwrap text')}}</a>
            <a href="#" id="files-wrap" class="hidden">{{ _('Wrap text')}}</a><br />
        </p>

        {% elif not files and status %}
            <p>{{ _('No files in the uploaded file.') }}</p>
        {% endif %}
    </div>
    <div id="thinking" class="hidden">
        <p class="waiting">
            {{ _('Fetching file.') }}
        </p>
    </div>
    <div id="content-wrapper">
        {% if msg %}
            <p>{{ msg }}</p>
        {% endif %}
        <div>
        {% if viewer %}
            {% if selected['binary'] and not selected['directory'] %}
                {% include "files/file.html" %}
            {% else %}
                {% if selected and content %}
                    <pre id="content" class="wrapped">{{ content }}</pre>
                {% elif content == '' %}
                    <p>{{ _('No content.') }}</p>
                {% endif %}
            {% endif %}
        {% endif %}
        {% if diff and not diff.is_binary() %}
            {% if text_one and text_two %}
                <pre id="diff" class="wrapped"></pre>
            {% endif %}
        {% endif %}
        {% if diff and diff.is_binary() %}
            <p>
            {% if diff.is_different() %}
                {{ _('Files are different.') }}<br/>
              {% else %}
                {{ _('Files are the same.') }}<br/>
            {% endif %}
            {% with selected = diff.one, file = diff.file_one.file %}
                {% include "files/file.html" %}
            {% endwith %}
            {% with selected = diff.two, file = diff.file_two.file %}
                {% include "files/file.html" %}
            {% endwith %}
            </p>
        {% endif %}
        {% if diff and not diff.is_binary() %}
            <div class="hidden">
                <pre id="file-one">{{ text_one }}</pre>
                <pre id="file-two">{{ text_two }}</pre>
            </div>
        {% endif %}
        </div>
    </div>
    <p class="help">
        {{ _('Shortcuts: prev j, next k') }}
    </p>
</div>
{% endblock %}
