{% extends "base.html" %}

{% block title %}
{% if query.q %}
  {{ page_title(_('Add-on Search Results for {0}')|f(query.q)) }}
{% else %}
  {{ page_title(_('Add-on Search Results')) }}
{% endif %}
{% endblock %}

{% block extrahead %}
<meta name="WT.oss" content="{{ query.q }}">
<meta name="WT.oss_r" content="{{ pager.paginator.count }}">
{% endblock %}

{% block content %}
<section class="primary" role="main">
  <header class="results-head">
    {{ breadcrumbs([(None, _('Search'))]) }}
    <h2>{{ _('Search Results') }}</h2>
    <h3 class="results-count">{{ showing(query.q, query.tag, pager) }}</h3>
  </header>

  <div class="listing results">
    {% if pager.object_list %}
      <div class="results-inner">
        {{ addon_listing_header(request.get_full_path()|urlparams(page=None),
                                form.fields.sort.choices, query.sort) }}
        {{ addon_listing_items(pager.object_list, show_date=query.sort, src='search') }}
      </div>
      <div class="listing-footer">
        {{ pager|paginator }}
      </div>
    {% else %}
      {% include 'search/no_results.html' %}
    {% endif %}
  </div>

</section>

<section class="secondary" role="complementary">
  <div id="refine-results" class="highlight">

    <h3>{{ _('Refine Results') }}</h3>
    <div id="refine-sort">
      <h5>{{ _('Sort by') }}</h5>
      <ul class="refinements">
        {% for val, choice in form.fields.sort.choices %}
          <li {% if val == query.sort %}class="selected"{% endif %}>
            <a href="{{ request.get_full_path()|urlparams(sort=val, page=None) }}">
              {{ choice }}</a>
          </li>
        {% endfor %}
      </ul>
    </div>

    <div id="refine-category">
      <h5>{{ _('Categories') }}</h5>
      <ul class="refinements">
        {% for addon_type, cats in categories %}
        <li {% if addon_type == query.atype and not query.cat %}class="selected"{% endif %}>
          <a href="{{ request.get_full_path()|urlparams(atype=addon_type, cat=None, page=None) }}">{{ amo.ADDON_TYPES[addon_type] }}</a></li>
        <li>
        <ul>
          {% for cat in cats %}
          <li {%if cat.id == query.cat %}class="selected"{% endif %}>
            <a href="{{ request.get_full_path()|urlparams(atype=addon_type, cat=cat.id, page=None) }}">{{ cat.name }}</a>
          </li>
          {% endfor %}
        </ul>
        </li>
        {% endfor %}
      </ul>
    </div>
    <div id="refine-compatibility">
      <h5>{{ _('Compatible with') }}</h5>
      <ul class="refinements">
        {% for version in versions if version|float not in APP.exclude_versions and version|float > APP.min_display_version %}
        <li {% if version == query.appver %}class="selected"{% endif %}>
          <a href="{{ request.get_full_path()|urlparams(appver=version, page=None) }}">
            {{ version }}</a>
        </li>
        {% endfor %}
      </ul>
    </div>
    <div id="refine-platforms">
      <h5>{{ _('Platforms') }}</h5>
      <ul class="refinements">
        {% for platform in APP.platforms.values() %}
          {% if platform in (amo.PLATFORM_ALL, amo.PLATFORM_ALL_MOBILE)
             or platform.id in platforms %}
            <li {% if platform.id == query.platform %}class="selected"{% endif %}>
              <a href="{{ request.get_full_path()|urlparams(platform=platform.shortname, page=None) }}">
                {{ platform.name }}</a>
            </li>
          {% endif %}
        {% endfor %}
      </ul>
    </div>
    <div id="refine-tags">
      <h5>{{ _('Tags') }}</h5>
      <ul class="refinements">
        {% for tag in qs.facets.tags %}
        <li {% if tag.term == query.tag %}class="selected"{% endif %}>
          <a href="{{ request.get_full_path()|urlparams(tag=tag.term, page=None) }}">
            {{ tag.term }}</a>
        </li>
        {% endfor %}
      </ul>
    </div>

  </div>
</section>
{% endblock %}
