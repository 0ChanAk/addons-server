{% extends "impala/base.html" %}

{% block title %}
{% if query.q %}
  {{ page_title(_('Add-on Search Results for {0}')|f(query.q)) }}
{% else %}
  {{ page_title(_('Add-on Search Results')) }}
{% endif %}
{% endblock %}

{% block bodyclass %}listing{% endblock %}

{% block extrahead %}
<meta name="WT.oss" content="{{ query.q }}">
<meta name="WT.oss_r" content="{{ pager.paginator.count }}">
{% endblock %}

{% block content %}
<section class="secondary refine" role="complementary">
  <h2>{{ _('Refine Results') }}</h2>

  <div>
    <h3>{{ _('Sort by') }}</h3>
    <ul>
      {% for val, choice in form.fields.sort.choices %}
        <li {% if val == query.sort %}class="selected"{% endif %}>
          <a href="{{ request.get_full_path()|urlparams(sort=val, page=None) }}">
            {{ choice }}</a>
        </li>
      {% endfor %}
    </ul>
  </div>

  <div>
    <ul>
      <li {% if not query.atype %}class="selected"{% endif %}>
        <a href="{{ request.get_full_path()|urlparams(atype=None, cat=None, page=None) }}">{{ _('All Add-ons') }}</a>
      </li>
      {% for addon_type, cats in categories %}
      <li {% if addon_type == query.atype and not query.cat %}class="selected"{% endif %}>
        <a href="{{ request.get_full_path()|urlparams(atype=addon_type, cat=None, page=None) }}">{{ amo.ADDON_TYPES[addon_type] }}</a></li>
      <li>
      <ul>
        {% for cat in cats %}
        <li {%if cat.id == query.cat %}class="selected"{% endif %}>
          <a href="{{ request.get_full_path()|urlparams(atype=addon_type, cat=cat.id, page=None) }}">{{ cat.name }}</a>
        </li>
        {% endfor %}
      </ul>
      </li>
      {% endfor %}
    </ul>
  </div>

  <div>
    <h3>{{ _('Compatible with') }}</h3>
    <ul>
      {% for version in versions if version|float not in APP.exclude_versions and version|float > APP.min_display_version %}
      <li {% if version == query.appver %}class="selected"{% endif %}>
        <a href="{{ request.get_full_path()|urlparams(appver=version, page=None) }}">
          {{ version }}</a>
      </li>
      {% endfor %}
    </ul>
  </div>

  <div>
    <h3>{{ _('Platforms') }}</h3>
    <ul>
      {% for platform in APP.platforms.values() %}
        {% if platform in (amo.PLATFORM_ALL, amo.PLATFORM_ALL_MOBILE)
           or platform.id in platforms %}
          <li {% if platform.id == query.platform %}class="selected"{% endif %}>
            <a href="{{ request.get_full_path()|urlparams(platform=platform.shortname, page=None) }}">
              {{ platform.name }}</a>
          </li>
        {% endif %}
      {% endfor %}
    </ul>
  </div>

  <div>
    <h3>{{ _('Tags') }}</h3>
    <ul>
      {% for tag in qs.facets.tags %}
      <li {% if tag.term == query.tag %}class="selected"{% endif %}>
        <a href="{{ request.get_full_path()|urlparams(tag=tag.term, page=None) }}">
          {{ tag.term }}</a>
      </li>
      {% endfor %}
    </ul>
  </div>
</section>

<section class="primary" role="main">

  <div class="listing results island hero c">
    <header>
      <h2>{{ _('Search Results') }}</h2>
    </header>
    <header>
      {{ impala_addon_listing_header(
             request.get_full_path()|urlparams(page=None),
             form.fields.sort.choices, query.sort) }}
    </header>
    {% if pager.object_list %}
      {{ pager|impala_paginator }}
      {{ impala_addon_listing_items(pager.object_list, show_date=query.sort,
                                    src='search') }}
      {{ pager|impala_paginator }}
    {% else %}
      {% include 'search/no_results.html' %}
    {% endif %}
  </div>

</section>
{% endblock %}
